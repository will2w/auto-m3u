name: IPTV Auto Builder Pro

on:
  schedule:
    - cron: "*/240 * * * *"   # 每 4 小时自动更新
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository 使用 PAT
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT_TOKEN }}

      # 2. 安装必需工具
      - name: Install Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y jq curl

      # 3. 下载 M3U 源列表
      - name: Download Source Lists
        run: |
          curl -L --retry 3 -o china.m3u    https://freetv.fun/test_channels_china_new.m3u
          curl -L --retry 3 -o hongkong.m3u https://freetv.fun/test_channels_hong_kong_new.m3u
          curl -L --retry 3 -o taiwan.m3u   https://freetv.fun/test_channels_taiwan_new.m3u

      # 4. 下载 EPG
      - name: Download EPG
        run: curl -L --retry 3 -o epg.xml http://epg.51zmt.top:8000/e.xml

      # 5. 生成 playlist
      - name: Build Playlist
        run: |
          mkdir -p output
          echo "#EXTM3

